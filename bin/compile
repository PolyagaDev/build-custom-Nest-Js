#!/bin/bash

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

echo "-----> Installing Node.js and npm using nvm"

# Télécharger et installer nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.4/install.sh | bash

# Charger nvm
export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm

# Installer et utiliser la version spécifiée de Node.js (adaptez à la version que vous souhaitez utiliser)
nvm install 14
nvm use 14

# Configurer les binaires pour qu'ils soient disponibles au runtime
export PATH="$NVM_BIN:$PATH"

echo "-----> Node.js version"
node -v

echo "-----> npm version"
npm -v

echo "-----> Installing dependencies"
cd "$BUILD_DIR" || exit
npm install

echo "-----> Building the application"
npm run build